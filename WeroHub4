local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local TweenService = game:GetService("TweenService")

local player = Players.LocalPlayer
local character = player.Character or player.CharacterAdded:Wait()
local hrp = character:WaitForChild("HumanoidRootPart")
local humanoid = character:WaitForChild("Humanoid")

local Rayfield = loadstring(game:HttpGet('https://sirius.menu/rayfield'))()

local Window = Rayfield:CreateWindow({
   Name = "WeroHub Steal a Brainrot",
   LoadingTitle = "WeroHub Steal a Brainrot Script",
   LoadingSubtitle = "by WeroScripts",
   ConfigurationSaving = {
      Enabled = true,
      FolderName = nil,
      FileName = "Big Hub"
   },
   Discord = { Enabled = false },
   KeySystem = false,
})

local Tab = Window:CreateTab("Main")

-- Variables para speed toggle
local SPEED_VALUE = 60
local originalWalkSpeed = 34
local speedBypassConnection

-- Variables ESP
local espFolder = Instance.new("Folder")
espFolder.Name = "ESPFolder"
espFolder.Parent = player:WaitForChild("PlayerGui")
local ESPs = {}

-- Variables Tung Bat Auto Punch
local AUTO_PUNCH_ENABLED = false
local TUNG_BAT_NAME = "Tung Bat"

-- Variables para posición guardada
local savedPosition = nil

-- Función para setear speed con bypass
local function setSpeed(speed)
    local character = player.Character or player.CharacterAdded:Wait()
    local humanoid = character:FindFirstChildOfClass("Humanoid")
    if not humanoid then return end

    if speedBypassConnection then speedBypassConnection:Disconnect() speedBypassConnection = nil end

    if speed == SPEED_VALUE then
        humanoid.WalkSpeed = SPEED_VALUE
        speedBypassConnection = RunService.Heartbeat:Connect(function()
            pcall(function()
                if humanoid and humanoid.WalkSpeed ~= SPEED_VALUE then
                    humanoid.WalkSpeed = SPEED_VALUE
                end
            end)
        end)
    else
        humanoid.WalkSpeed = originalWalkSpeed
    end
end

-- Funciones ESP
local function createESPForPlayer(targetPlayer)
    if targetPlayer == player then return end
    local character = targetPlayer.Character
    if not character then return end
    local head = character:FindFirstChild("Head")
    if not head then return end

    if ESPs[targetPlayer] then return end

    local highlight = Instance.new("Highlight")
    highlight.Name = "ESPHighlight"
    highlight.Adornee = character
    highlight.FillColor = Color3.new(1, 0, 0)
    highlight.OutlineColor = Color3.new(1, 1, 1)
    highlight.Parent = espFolder

    local billboard = Instance.new("BillboardGui")
    billboard.Name = "ESPName"
    billboard.Adornee = head
    billboard.Size = UDim2.new(0, 150, 0, 35)
    billboard.StudsOffset = Vector3.new(0, 2.5, 0)
    billboard.AlwaysOnTop = true
    billboard.Parent = espFolder

    local textLabel = Instance.new("TextLabel")
    textLabel.Size = UDim2.new(1, 0, 1, 0)
    textLabel.BackgroundTransparency = 1
    textLabel.TextColor3 = Color3.new(1, 1, 1)
    textLabel.TextStrokeColor3 = Color3.new(0, 0, 0)
    textLabel.TextStrokeTransparency = 0
    textLabel.Font = Enum.Font.SourceSansBold
    textLabel.TextSize = 20
    textLabel.Text = targetPlayer.Name
    textLabel.Parent = billboard

    ESPs[targetPlayer] = {
        Highlight = highlight,
        Billboard = billboard,
        TextLabel = textLabel
    }
end

local function removeESPForPlayer(targetPlayer)
    local esp = ESPs[targetPlayer]
    if esp then
        if esp.Highlight then esp.Highlight:Destroy() end
        if esp.Billboard then esp.Billboard:Destroy() end
        ESPs[targetPlayer] = nil
    end
end

local function updateESP()
    for targetPlayer, esp in pairs(ESPs) do
        local character = targetPlayer.Character
        if character and character.Parent then
            for _, part in pairs(character:GetChildren()) do
                if part:IsA("BasePart") then
                    part.LocalTransparencyModifier = 0
                end
            end
        else
            removeESPForPlayer(targetPlayer)
        end
    end
end

Players.PlayerAdded:Connect(function(plr)
    plr.CharacterAdded:Connect(function()
        wait(0.5)
        createESPForPlayer(plr)
    end)
end)

for _, plr in pairs(Players:GetPlayers()) do
    if plr ~= player then
        if plr.Character then
            createESPForPlayer(plr)
        end
        plr.CharacterAdded:Connect(function()
            wait(0.5)
            createESPForPlayer(plr)
        end)
    end
end

-- Auto Tung Bat Punch
local function tryAutoPunch()
    if not AUTO_PUNCH_ENABLED then return end
    local character = player.Character
    if not character then return end
    local humanoid = character:FindFirstChildOfClass("Humanoid")
    local hrp = character:FindFirstChild("HumanoidRootPart")
    if not humanoid or not hrp then return end

    local tool = player.Character:FindFirstChildOfClass("Tool")
    if not tool or tool.Name ~= TUNG_BAT_NAME then return end

    for _, targetPlayer in pairs(Players:GetPlayers()) do
        if targetPlayer ~= player and targetPlayer.Character and targetPlayer.Character:FindFirstChild("HumanoidRootPart") then
            local targetHRP = targetPlayer.Character.HumanoidRootPart
            local distance = (hrp.Position - targetHRP.Position).Magnitude
            if distance <= 10 then
                -- Intentamos disparar el RemoteEvent si existe (mejor que Activate)
                local remote = tool:FindFirstChildWhichIsA("RemoteEvent")
                if remote then
                    remote:FireServer(targetPlayer)
                else
                    tool:Activate()
                end
                break
            end
        end
    end
end

RunService.Heartbeat:Connect(tryAutoPunch)
RunService.Heartbeat:Connect(updateESP)

-- Función bypass teletransporte a la posición guardada
local function bypassTeleport(targetPos)
    if not hrp or not targetPos then return end
    -- Teletransporta arriba 50 studs
    local upPos = hrp.Position + Vector3.new(0, 50, 0)
    hrp.CFrame = CFrame.new(upPos)
    wait(0.15)
    -- Tween para bajar suavemente a targetPos + 3 studs arriba
    local tween = TweenService:Create(hrp, TweenInfo.new(0.5, Enum.EasingStyle.Linear), {CFrame = CFrame.new(targetPos + Vector3.new(0, 3, 0))})
    tween:Play()
    tween.Completed:Wait()
end

-- Toggles y botones Rayfield
Tab:CreateToggle({
    Name = "Speed 60 Bypass",
    CurrentValue = false,
    Flag = "SpeedToggle",
    Callback = function(value)
        setSpeed(value and SPEED_VALUE or originalWalkSpeed)
    end,
})

Tab:CreateToggle({
    Name = "ESP Players",
    CurrentValue = false,
    Flag = "ESPToggle",
    Callback = function(value)
        if value then
            for _, plr in pairs(Players:GetPlayers()) do
                if plr ~= player and plr.Character then
                    createESPForPlayer(plr)
                end
            end
        else
            for plr, _ in pairs(ESPs) do
                removeESPForPlayer(plr)
            end
        end
    end,
})

Tab:CreateToggle({
    Name = "Auto Tung Bat Punch (10 studs)",
    CurrentValue = false,
    Flag = "AutoTungBatToggle",
    Callback = function(value)
        AUTO_PUNCH_ENABLED = value
    end,
})

-- Botón para guardar posición
Tab:CreateButton({
    Name = "Guardar Posición",
    Callback = function()
        if hrp then
            savedPosition = hrp.Position
            Rayfield:Notify({
                Title = "Posición guardada",
                Content = "Se guardó tu posición actual.",
                Duration = 3
            })
        end
    end,
})

-- Botón para teleportear con bypass a la posición guardada
Tab:CreateButton({
    Name = "Bypass Teletransportar a posición",
    Callback = function()
        if savedPosition then
            bypassTeleport(savedPosition)
            Rayfield:Notify({
                Title = "Teletransportado",
                Content = "Has sido teletransportado a la posición guardada.",
                Duration = 3
            })
        else
            Rayfield:Notify({
                Title = "Error",
                Content = "No tienes una posición guardada.",
                Duration = 3
            })
        end
    end,
})


